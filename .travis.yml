matrix:
  include:
    - if: branch = master OR branch = gateway
      language: python
      cache:
        directories:
          - ffmpeg-3.2/
      python: 3.6
      dist: xenial
      install:
        - Gateway/bin/install_gatewayw_dependencies
      before_script:
        - cd Gateway/gatewayw/
        - python setup.py sdist
        - pip install dist/gatewayw*.tar.gz
      script:
        - ./tests/test_gatewayw.sh ../etc/
    - if: branch = master OR branch = server
      language: node_js
      node_js:
        - "8"
      services:
        - mongodb
      install:
        - cd Server
        - npm install
      before_script:
        - sleep 10
      script:
        - ./run_tests
    - if: branch = master OR branch = client-ios
      language: objective-c
      os: osx
      osx_image: xcode10.1
      cache:
        directories:
        - Client-iOS/Carthage
      before_install:
        - brew install carthage || true
        - brew outdated carthage || brew upgrade carthage
        - gem install xcpretty-travis-formatter --no-rdoc --no-ri --no-document --quiet
      install:
        - cd Client-iOS/
        - sh build-dependancies.sh
      script:
        - set -o pipefail
        - xcodebuild clean test -project "SIMplePhone.xcodeproj" -scheme "SIMplePhoneKitTests" -destination "OS=12.1,name=iPhone X" -sdk "iphonesimulator12.1" CODE_SIGNING_REQUIRED=NO ONLY_ACTIVE_ARCH=NO | xcpretty -f 'xcpretty-travis-formatter'

notifications:
  email:
    - quentin@wendegass.com
    - mail@lukaskuster.com
